

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cmlabs.interpolate._interpolate &mdash; cmlabs 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            cmlabs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cmlabs.interpolate.html">Interpolation (<code class="xref py py-mod docutils literal notranslate"><span class="pre">cmlabs.interpolate</span></code>)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">cmlabs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cmlabs.interpolate._interpolate</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cmlabs.interpolate._interpolate</h1><div class="highlight"><pre>
<span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;lagrange&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lagrange_remainder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;divided_differences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;newton&quot;</span><span class="p">,</span>
    <span class="s2">&quot;finite_differences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forward_differences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;backward_differences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;newtonfd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;newtonbd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gaussfd&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sps</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>


<div class="viewcode-block" id="lagrange">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.lagrange.html#cmlabs.interpolate.lagrange">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lagrange</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Lagrange interpolation polynomial value at :math:`x`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{align*}</span>
<span class="sd">        P_n(x) &amp;= L_n(x) = \sum_{i=0}^{n} l_i(x) f(x_i) \\</span>
<span class="sd">        l_i(x) &amp;= \prod_{j=0, j \neq i}^{n} \frac{x - x_j}{x_i - x_j}</span>
<span class="sd">        \end{align*}</span>

<span class="sd">    where :math:`l_i(x)` is the Lagrange basis polynomial for the i-th data point.</span>

<span class="sd">    Return the value of the Lagrange polynomial that has degree `n = len(xvals)-1`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The sorted x-coordinates of the data points.</span>
<span class="sd">    yvals : array_like, 1-D</span>
<span class="sd">        The y-coordinates of the data points, i.e., f(:math:`x`).</span>
<span class="sd">    x : float</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the polynomial at :math:`x`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import lagrange</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, 2, 3, 5])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; x = np.float32(1.5)</span>
<span class="sd">    &gt;&gt;&gt; lagrange(xvals, yvals, x)</span>
<span class="sd">    3.3375000000000004</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;xvals and yvals must have the same length&quot;</span><span class="p">)</span>

    <span class="n">L_n</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">l_i</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">l_i</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">L_n</span> <span class="o">+=</span> <span class="n">yvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">l_i</span>

    <span class="k">return</span> <span class="n">L_n</span></div>



<div class="viewcode-block" id="lagrange_remainder">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.lagrange_remainder.html#cmlabs.interpolate.lagrange_remainder">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lagrange_remainder</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Remainder in Lagrange interpolation formula.</span>

<span class="sd">    Common notation for the Lagrange interpolation polynomial is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">        R_n(x) &amp;= f(x) - L_n(x)</span>
<span class="sd">                = \frac{f^{(n+1)}(\xi)}{(n+1)!} \prod_{i=0}^{n} (x - x_i), \quad</span>
<span class="sd">                \xi \in (a, b) \\</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">    where :math:`L_n(x)` is the Lagrange polynomial of degree `n`,</span>
<span class="sd">    :math:`R_n(x)` is the remainder term and `n = len(xvals)-1`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The x-coordinates of the data points.</span>
<span class="sd">    M : float</span>
<span class="sd">        The bound for the (n+1)-th derivative of the function.</span>
<span class="sd">    x : float, optional</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>
<span class="sd">        Only used if `method` is &#39;exact&#39;.</span>
<span class="sd">    mehtod : {&#39;auto&#39;, &#39;exact&#39;, &#39;bound&#39;}, optional</span>
<span class="sd">        Defines the method to compute the remainder.</span>
<span class="sd">        The following options are available (default is &#39;bound&#39;):</span>

<span class="sd">          * &#39;auto&#39; : uses &#39;exact&#39; if :math:`x` is provided, otherwise uses &#39;bound&#39;.</span>
<span class="sd">          * &#39;exact&#39; : uses the exact formula for the remainder term.</span>
<span class="sd">          * &#39;bound&#39; : uses the bound formula for the remainder term.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the remainder term.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The `method` parameter determines how the remainder term is computed.</span>
<span class="sd">    If `method` is &#39;exact&#39;, the function will compute the exact value of the</span>
<span class="sd">    remainder term using the formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        |R_n(x)| \leq \frac{M_{n+1}}{(n+1)!} \prod_{i=0}^{n} |x - x_i|</span>

<span class="sd">    where :math:`n` is the length of the `xvals` array, :math:`M_{n+1}` is the bound for</span>
<span class="sd">    the (n+1)-th derivative of the function.</span>

<span class="sd">    If `method` is &#39;bound&#39;, the function will compute the bound for the remainder term</span>
<span class="sd">    using the formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        |f(x) - L_n(x)| \leq \frac{M_{n+1}(x_{[n]}-x_{[0]})^{n+1}}{2^{2n+1}(n+1)!}</span>

<span class="sd">    where :math:`x_{[i]}` is the i-th element of the sorted `xvals` array</span>

<span class="sd">    This formula follows from the properties of Chebyshev polynomials.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import lagrange, lagrange_remainder</span>
<span class="sd">    &gt;&gt;&gt; # f(x) = sin(x)</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, np.pi/2, np.pi/2])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([0, 1/2, 1])</span>
<span class="sd">    &gt;&gt;&gt; # M_3 = max |f&#39;&#39;&#39;(x)| = 1</span>
<span class="sd">    &gt;&gt;&gt; M_3 = 1.0</span>
<span class="sd">    &gt;&gt;&gt; x = np.pi / 8</span>
<span class="sd">    &gt;&gt;&gt; abs(np.sin(x) - lagrange(xvals, yvals, x))</span>
<span class="sd">    0.007941567634910107</span>
<span class="sd">    &gt;&gt;&gt; # Exact remainder</span>
<span class="sd">    &gt;&gt;&gt; lagrange_remainder(xvals, M, x)</span>
<span class="sd">    0.010093189023535093</span>
<span class="sd">    &gt;&gt;&gt; # Bound remainder</span>
<span class="sd">    &gt;&gt;&gt; lagrange_remainder(xvals, M)</span>
<span class="sd">    0.020186378047070193</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;bound&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;exact&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;exact&quot;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">*=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;bound&quot;</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">M</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="divided_differences">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.divided_differences.html#cmlabs.interpolate.divided_differences">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">divided_differences</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the ordered divided differences list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The x-coordinates of the data points.</span>
<span class="sd">    yvals : array_like, 1-D</span>
<span class="sd">        The y-coordinates of the data points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: array_like, 1-D</span>
<span class="sd">        The divided differences list.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The divided differences list has the following structure:</span>

<span class="sd">    .. math::</span>

<span class="sd">        [f(x_0), f(x_0, x_1), f(x_0, x_1, x_2), \ldots, f(x_0, x_1, \ldots, x_n)]</span>

<span class="sd">    Algorithm is based on the following formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x_0, x_1, \ldots, x_n) = \frac{f(x_1, \ldots, x_n) -</span>
<span class="sd">        f(x_0, \ldots, x_{n-1})}{x_n - x_0}</span>

<span class="sd">    where :math:`f(x_0, x_1, \ldots, x_n)` is the divided difference of the function</span>
<span class="sd">    at the points :math:`x_0, x_1, \ldots, x_n`.</span>

<span class="sd">    It starts moving from the right side of the array, so the iterations look like this:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">            \\</span>
<span class="sd">            [f(x_0), f(x_1), \ldots, f(x_n)] &amp;\to</span>
<span class="sd">            [f(x_0), f(x_0, x_1), \ldots, f(x_{n-1}, x_n)] \\</span>
<span class="sd">            [f(x_0), f(x_0, x_1), \ldots, f(x_{n-1}, x_n)] &amp;\to</span>
<span class="sd">            [f(x_0), f(x_0, x_1), f(x_0, x_1, x_3), \ldots, f(x_{n-2}, x_{n-1}, x_n)] \\</span>
<span class="sd">            &amp;\vdots \\</span>
<span class="sd">            [f(x_0), f(x_0, x_1), \ldots, f(x_1, x_2, \ldots, x_n)] &amp;\to</span>
<span class="sd">            [f(x_0), f(x_0, x_1), \ldots, f(x_0, x_1, \ldots, x_n)]</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">    The divided differences list is used to compute the coefficients of the Newton</span>
<span class="sd">    interpolation polynomial.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;xvals and yvals must have the same length&quot;</span><span class="p">)</span>

    <span class="n">coef</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">coef</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">coef</span></div>



<div class="viewcode-block" id="newton">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.newton.html#cmlabs.interpolate.newton">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">newton</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Newton interpolation polynomial value at :math:`x`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">        L_n(x) = \sum_{i=0}^{n} f(x_0, x_1, \ldots, x_i) \omega_i(x), \\</span>
<span class="sd">        \omega_0(x) = 1, \quad \omega_1(x) = x - x_0, \quad</span>
<span class="sd">        \omega_i(x) = \prod_{j=0, j \neq i}^{n} (x - x_j), i \geq 2</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    where :math:`f(x_0, x_1, \ldots, x_i)` is the divided difference of the function</span>
<span class="sd">    at the points :math:`x_0, x_1, \ldots, x_i`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The sorted x-coordinates of the data points.</span>
<span class="sd">    x : float</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>
<span class="sd">    yvals : array_like, 1-D, optional</span>
<span class="sd">        The y-coordinates of the data points, i.e., f(:math:`x`).</span>
<span class="sd">        Only used if `coef` is not provided.</span>
<span class="sd">    coef : array_like, 1-D, optional</span>
<span class="sd">        The coefficients of the Newton polynomial.</span>
<span class="sd">        If not provided, the function will compute the divided differences list</span>
<span class="sd">        using the `divided_differences` function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the polynomial at :math:`x`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    divided_differences</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The `coef` parameter is optional and can be used to provide the coefficients</span>
<span class="sd">    of the Newton polynomial. If not provided, the function will compute the</span>
<span class="sd">    divided differences list using the `divided_differences` function.</span>

<span class="sd">    The divided differences list has the following structure:</span>

<span class="sd">    .. math::</span>

<span class="sd">        [f(x_0), f(x_0, x_1), f(x_0, x_1, x_2), \ldots, f(x_0, x_1, \ldots, x_n)]</span>

<span class="sd">    Use Horner&#39;s method to compute the value of the polynomial at :math:`x`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P(x) = a_0 + (x - x_0)(a_1 + (x - x_1)(a_2 + \ldots)) \\</span>
<span class="sd">            a_0 = f(x_0), \quad a_1 = f(x_0, x_1), \quad</span>
<span class="sd">            a_2 = f(x_0, x_1, x_2), \quad \ldots, \quad</span>
<span class="sd">            a_n = f(x_0, x_1, \ldots, x_n)</span>
<span class="sd">        \end{gather}</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import newton</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, 2, 3, 5])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; x = np.float32(1.5)</span>
<span class="sd">    &gt;&gt;&gt; newton(xvals, x, yvals=yvals)</span>
<span class="sd">    3.3375</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coef must have the same length as xvals and yvals&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">divided_differences</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either yvals or coef must be provided&quot;</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">coef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="finite_differences">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.finite_differences.html#cmlabs.interpolate.finite_differences">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">finite_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the finite differences table.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            \Delta^k f(x_i) = f(x_{i+1}) - f(x_i), \\</span>
<span class="sd">            \nabla^k f(x_i) = f(x_i) - f(x_{i-1})</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    yvals : array_like, 1-D</span>
<span class="sd">        The y-coordinates of the data points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: array_like, 2-D</span>
<span class="sd">        The finite differences table.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The output is the table with following structure:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \left[\begin{gather}</span>
<span class="sd">        [\Delta^0 f(x_0) \quad \Delta^0 f(x_1) \quad \ldots \quad \Delta^0 f(x_n)] \\</span>
<span class="sd">        [\Delta^1 f(x_0) \quad \Delta^1 f(x_1) \quad \ldots \quad \Delta^1 f(x_{n-1})]\\</span>
<span class="sd">        [\Delta^2 f(x_0) \quad \Delta^2 f(x_1) \quad \ldots \quad \Delta^2 f(x_{n-2})]\\</span>
<span class="sd">        \vdots \\</span>
<span class="sd">        [\Delta^n f(x_0)]</span>
<span class="sd">        \end{gather}\right]</span>

<span class="sd">    Or it can be treated as...</span>

<span class="sd">    .. math::</span>

<span class="sd">        \left[\begin{gather}</span>
<span class="sd">        [\nabla^0 f(x_0) \quad \nabla^0 f(x_1) \quad \ldots \quad \nabla^0 f(x_n)] \\</span>
<span class="sd">        [\nabla^1 f(x_1) \quad \nabla^1 f(x_1) \quad \ldots \quad \nabla^1 f(x_n)]\\</span>
<span class="sd">        [\nabla^2 f(x_2) \quad \nabla^2 f(x_1) \quad \ldots \quad \nabla^2 f(x_n)]\\</span>
<span class="sd">        \vdots \\</span>
<span class="sd">        [\nabla^n f(x_n)]</span>
<span class="sd">        \end{gather}\right]</span>

<span class="sd">    where `n = len(yvals) - 1`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import finite_differences</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; finite_differences(yvals)</span>
<span class="sd">    &gt;&gt;&gt; [[1, 3, 2, 5], [2, -1, 3], [-3, 4], [7]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">prev</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev</span><span class="p">))]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">table</span></div>



<div class="viewcode-block" id="forward_differences">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.forward_differences.html#cmlabs.interpolate.forward_differences">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">forward_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the forward differences list for :math:`f(x_0)`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            \Delta^k f(x_i) = \Delta^{k-1} f(x_{i+1}) - \Delta^{k-1} f(x_i)</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    yvals : array_like, 1-D</span>
<span class="sd">        The y-coordinates of the data points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: array_like, 1-D</span>
<span class="sd">        The forward differences list.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The output is the list with following structure:</span>

<span class="sd">    .. math::</span>

<span class="sd">        [\Delta^0 f(x_0), \Delta^1 f(x_0), \Delta^2 f(x_0), \ldots, \Delta^n f(x_0)]</span>

<span class="sd">    where `n = len(yvals) - 1`.</span>

<span class="sd">    The forward differences list is used to compute the coefficients</span>
<span class="sd">    of the Newton Forward-Difference Formula</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import forward_differences</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; forward_differences(yvals)</span>
<span class="sd">    &gt;&gt;&gt; [1, 2, -3, 7]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">finite_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">table</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))])</span></div>



<div class="viewcode-block" id="backward_differences">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.backward_differences.html#cmlabs.interpolate.backward_differences">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">backward_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the backward differences list for :math:`f(x_n)`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            \nabla^k f(x_i) = \nabla^{k-1} f(x_{i+1}) - \nabla^{k-1} f(x_i)</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    yvals : array_like, 1-D</span>
<span class="sd">        The y-coordinates of the data points.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: array_like, 1-D</span>
<span class="sd">        The backward differences list.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The output is the list with following structure:</span>

<span class="sd">    .. math::</span>

<span class="sd">        [\nabla^0 f_n, \nabla^1 f_n, \nabla^2 f_n, \ldots, \nabla^n f_n]</span>

<span class="sd">    where `n = len(yvals) - 1`.</span>

<span class="sd">    The backward differences list is used to compute the coefficients</span>
<span class="sd">    of the Newton Backward-Difference Formula</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import backward_differences</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; backward_differences(yvals)</span>
<span class="sd">    &gt;&gt;&gt; [5, 3, 4, 7]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">finite_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">table</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))])</span></div>



<div class="viewcode-block" id="newtonfd">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.newtonfd.html#cmlabs.interpolate.newtonfd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">newtonfd</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Newton&#39;s forward interpolation formula.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} \frac{\Delta^k f(x_0)}{k!h^k} \omega_k(x) \\</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} C^k_t \Delta^k f(x_0)</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    where :math:`\Delta^k f_0` is the forward difference of the function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The sorted x-coordinates of the data points.</span>
<span class="sd">    x : float</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>
<span class="sd">    yvals : array_like, 1-D, optional</span>
<span class="sd">        The y-coordinates of the data points, i.e., f(:math:`x`).</span>
<span class="sd">        Only used if `coef` is not provided.</span>
<span class="sd">    coef : array_like, 1-D, optional</span>
<span class="sd">        The forward differences list.</span>
<span class="sd">        If not provided, the function will compute the forward differences table</span>
<span class="sd">        using the `forward_differences`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the polynomial at :math:`x`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    forward_differences</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The relation between divided difference and forward difference is</span>
<span class="sd">    proved by induction.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            f(x_0, x_1, \ldots, x_k) = \frac{\Delta^k f(x_0)}{k! h^k},</span>
<span class="sd">            \quad h = x_{i+1} - x_i = const</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    So the Newton polynomial can be written as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} \frac{\Delta^k f(x_0)}{k!h^k} \omega_k(x) \\</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    Using a variable :math:`t = \frac{x - x_0}{h}` we can rewrite the polynomial as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} \frac{t(t-1)\ldots(t-k+1)}{k!} \Delta^k f(x_0) \\</span>
<span class="sd">            C^k_n = \frac{n(n-1)\ldots(n-k+1)}{k!}, \quad k \geq 2, \quad C^0_n = 1,</span>
<span class="sd">            \quad C^1_n = n \\</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} C^k_t \Delta^k f(x_0) \\</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    This method is beneficial for determining values of :math:`x` at the</span>
<span class="sd">    beginning of a tabulated equally spaced set of values, i.e. :math:`0 &lt; t &lt; 1`.</span>
<span class="sd">    Also for extrapolating values of :math:`x` a bit backward (i.e. to the left)</span>
<span class="sd">    of :math:`x_0`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import newtonfd</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, 1, 2, 3])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; x = np.float32(0.5)</span>
<span class="sd">    &gt;&gt;&gt; newtonfd(xvals, x, yvals=yvals)</span>
<span class="sd">    &gt;&gt;&gt; 2.8125</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

    <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coef must have the same length as xvals and yvals&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">forward_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either yvals or coef must be provided&quot;</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">sps</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">coef</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="newtonbd">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.newtonbd.html#cmlabs.interpolate.newtonbd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">newtonbd</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Newton&#39;s backward interpolation formula.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} \frac{\nabla^k f(x_n)}{k!h^k} \omega_k(x) \\</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} C^k_t \nabla^k f(x_n)</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    where :math:`\nabla^k f_n` is the backward difference of the function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The sorted x-coordinates of the data points.</span>
<span class="sd">    x : float</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>
<span class="sd">    yvals : array_like, 1-D, optional</span>
<span class="sd">        The y-coordinates of the data points, i.e., f(:math:`x`).</span>
<span class="sd">        Only used if `coef` is not provided.</span>
<span class="sd">    coef : array_like, 1-D, optional</span>
<span class="sd">        The backward differences list.</span>
<span class="sd">        If not provided, the function will compute the backward differences table</span>
<span class="sd">        using the `backward_differences`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the polynomial at :math:`x`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    backward_differences</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The relation between divided difference and backward difference is</span>
<span class="sd">    proved by induction.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            f(x_0, x_1, \ldots, x_k) = \frac{\nabla^k f(x_n)}{k! h^k},</span>
<span class="sd">            \quad h = x_i - x_{i-1} = const</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    So the Newton polynomial can be written as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} \frac{\nabla^k f(x_n)}{k!h^k} \omega_k(x) \\</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    Using a variable :math:`s = \frac{x - x_n}{h}` we can rewrite the polynomial as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{gather}</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n}</span>
<span class="sd">            \frac{s(s+1)\ldots(s+k-1)}{k!} \nabla^k f(x_n) \\</span>
<span class="sd">            C^k_{-n} = \frac{-n(-n-1)\ldots(-n-k+1)}{k!} = (-1)^k</span>
<span class="sd">            \frac{n(n+1)\ldots(n+k-1)}{k!} \\</span>
<span class="sd">            P_n(x) = \sum_{k=0}^{n} (-1)^k C^k_{-s} \nabla^k f(x_n) \\</span>
<span class="sd">        \end{gather}</span>

<span class="sd">    This method is beneficial for determining values of :math:`x` at the end of the</span>
<span class="sd">    tabulated equally spaced set of values, i.e. :math:`-1 &lt; t &lt; 0`. Also for</span>
<span class="sd">    extrapolating values of :math:`x` a little ahead (to the right) of :math:`x_n`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import newtonbd</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, 1, 2, 3])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; x = np.float32(2.5)</span>
<span class="sd">    &gt;&gt;&gt; newtonbd(xvals, x, yvals=yvals)</span>
<span class="sd">    2.5625</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

    <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coef must have the same length as xvals and yvals&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">backward_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either yvals or coef must be provided&quot;</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sps</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">coef</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="gaussfd">
<a class="viewcode-back" href="../../../_autosummary/cmlabs.interpolate.gaussfd.html#cmlabs.interpolate.gaussfd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">gaussfd</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coef</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Gauss’s forward interpolation formula.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">            P_n(x) &amp;= \Delta^0 f(x_m) + \\</span>
<span class="sd">            &amp;+ t \Delta^1 f(x_m) + \\</span>
<span class="sd">            &amp;+ \frac{t(t-1)}{2!} \Delta^2 f(x_{m-1}) + \\</span>
<span class="sd">            &amp;+ \frac{(t+1)t(t-1)}{3!} \Delta^3 f(x_{m-1}) + \\</span>
<span class="sd">            &amp;+ \frac{(t+1)t(t-1)(t-2)}{4!} \Delta^4 f(x_{m-2}) + \\</span>
<span class="sd">            &amp;+ \frac{(t+2)(t+1)t(t-1)(t-2)}{5!} \Delta^5 f(x_{m-2}) + \\</span>
<span class="sd">            &amp;+ \frac{(t+2)(t+1)t(t-1)(t-2)(t-3)}{6!} \Delta^6 f(x_{m-3}) + \ldots</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">    where :math:`x_m` is the midpoint of the data point (if even then :math:`x_{n/2}`)</span>
<span class="sd">    and :math:`t = \frac{x-x_m}{h}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xvals : array_like, 1-D</span>
<span class="sd">        The sorted x-coordinates of the data points.</span>
<span class="sd">    x : float</span>
<span class="sd">        The x-coordinate at which to evaluate the polynomial.</span>
<span class="sd">    yvals : array_like, 1-D, optional</span>
<span class="sd">        The y-coordinates of the data points, i.e., f(:math:`x`).</span>
<span class="sd">        Only used if `coef` is not provided.</span>
<span class="sd">    coef : array_like, 2-D, optional</span>
<span class="sd">        The forward differences table.</span>
<span class="sd">        If not provided, the function will compute the finite differences table</span>
<span class="sd">        using the `finite_differences` function.</span>
<span class="sd">    m : int, optional</span>
<span class="sd">        The index of the midpoint of the data points.</span>
<span class="sd">        If not provided, the function will compute it using the formula:</span>
<span class="sd">        :math:`m = \frac{n}{2}` if `n` is even, otherwise :math:`m = \frac{n+1}{2}`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res: float</span>
<span class="sd">        The value of the polynomial at :math:`x`.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    finite_differences</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Gauss’s forward interpolation formula is best applicable for determining</span>
<span class="sd">    the values near the middle of the table.</span>

<span class="sd">    .. math::</span>

<span class="sd">        x = x_m + t h, \quad 0 &lt; t &lt; \frac{1}{2}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from cmlabs.interpolate import gaussfd</span>
<span class="sd">    &gt;&gt;&gt; xvals = np.array([0, 1, 2, 3])</span>
<span class="sd">    &gt;&gt;&gt; yvals = np.array([1, 3, 2, 5])</span>
<span class="sd">    &gt;&gt;&gt; x = np.float32(1.5)</span>
<span class="sd">    &gt;&gt;&gt; gaussfd(xvals, x, yvals=yvals)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;m must be less than n&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xvals</span><span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span>

    <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coef must have the same length as xvals and yvals&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="n">finite_differences</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">coef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either yvals or coef must be provided&quot;</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">prod</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># sign = 1</span>

    <span class="c1"># TODO: dodelat&#39;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coef</span><span class="p">)):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># prod *= t + sign * ((k - 1) // 2)</span>
        <span class="c1"># sign *= -1</span>
        <span class="n">prod</span> <span class="o">*=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">term</span> <span class="o">=</span> <span class="p">(</span><span class="n">prod</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="o">*</span> <span class="n">coef</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">term</span>

    <span class="k">return</span> <span class="n">res</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Roman Sokolovsky.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>